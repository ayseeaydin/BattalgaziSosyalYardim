@model BattalgaziSosyalYardim.Models.ApplicationCreateViewModel

@{
    Layout = "~/Views/Shared/_Bootstrap5Layout.cshtml";
    ViewData["Title"] = "Başvuru Formu";
}

@section Styles {
    <style>
        /* === İki kartın aynı yükseklik olması için === */
        .equal-row {
            align-items: stretch;
        }

            .equal-row > [class^="col-"],
            .equal-row > [class*=" col-"] {
                display: flex;
            }

        .form-section, .info-card {
            height: 100%;
            width: 100%;
        }

        /* Mobilde doğal akış */
        @@media (max-width: 991.98px) {
            .equal-row > [class^="col-"],
            .equal-row > [class*=" col-"] {
                display: block;
            }

            .form-section, .info-card {
                height: auto;
            }

            .info-card {
                margin-top: 18px;
            }
        }

        body {
            background: url('/thema/img/belediye.jpg') no-repeat center center fixed;
            background-size: cover;
        }

        .background-overlay {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            filter: brightness(.7);
            z-index: -1;
        }

        .custom-card {
            background-color: rgba(255,255,255,.50);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,.2);
            overflow: hidden;
        }

        .form-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid #ddd;
            background: #EBEEEF;
        }

            .form-header img {
                height: 60px;
            }

            .form-header h2 {
                flex-grow: 1;
                text-align: center;
                margin: 0;
                font-size: 1.5rem;
                font-weight: 700;
                color: #145374;
            }

        /* Sağ altta yuvarlak, saydam FAB */
        .admin-login {
            position: fixed;
            right: 16px;
            bottom: 16px;
            z-index: 1000;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            background: rgba(255,255,255,.55);
            color: #0f4c75;
            border: 1px solid rgba(255,255,255,.65);
            box-shadow: 0 8px 22px rgba(0,0,0,.25);
            backdrop-filter: blur(6px);
            text-decoration: none;
            font-size: 22px;
            line-height: 1;
        }

            .admin-login:hover {
                background: rgba(255,255,255,.75);
                transform: translateY(-1px);
                transition: all .15s ease;
            }

            .admin-login:focus {
                outline: 0;
                box-shadow: 0 0 0 3px rgba(16,112,202,.25), 0 8px 22px rgba(0,0,0,.25);
            }
        /* Erişilebilir gizli etiket */
        .visually-hidden {
            position: absolute !important;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0 0 0 0);
            white-space: nowrap;
            border: 0;
        }

        .req::after {
            content: " *";
            color: #d00;
            font-weight: 700;
        }

        /* Sağ bilgi kartı */
        .info-card {
            background: #f7fbff;
            border: 1px solid rgba(0,0,0,.06);
            border-radius: 16px;
            box-shadow: 0 8px 18px rgba(0,0,0,.06);
            padding: 16px;
        }

            .info-card h5 {
                font-weight: 700;
                color: #124f7c;
                margin-bottom: 10px;
            }

        .info-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0 14px;
        }

        .info-pill {
            background: #e6f4ff;
            border: 1px solid #cbe7ff;
            border-radius: 10px;
            padding: 8px 10px;
            font-size: .92rem;
            color: #0f4c75;
            text-align: center;
        }

        .info-card ul {
            margin: 0 0 10px 1.2rem;
        }

        .info-note {
            color: #b00020;
            font-weight: 700;
            text-align: center;
            font-size: 1.05rem;
            margin-top: 10px;
        }

        /* Form alanları */
        .form-section {
            background: #fff;
            border-radius: 12px;
        }
    </style>
}

<a href="/Login/Login" class="admin-login" title="Yönetici Girişi" aria-label="Yönetici Girişi">
    👤
    <span class="visually-hidden">Yönetici Girişi</span>
</a>

<div class="background-overlay"></div>

<div class="container mt-5 mb-5">
    <div class="card custom-card">
        <div class="form-header">
            <img src="/thema/img/logo.png" alt="Logo" />
            <h2>@(Model?.ProgramTitle ?? "0-2 YAŞ BEBEK BEZİ DESTEĞİ BAŞVURU FORMU")</h2>
            <img src="/thema/img/aile.jpg" alt="Bebek" style="width:90px;" />
        </div>

        <div class="card-body p-4">
            @* Hata özetini alan etiketleriyle gösterelim *@
            @{
                var labels = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
                {
                    [nameof(Model.MotherNationalId)] = "Anne T.C. Kimlik No",
                    [nameof(Model.MotherBirthDate)] = "Anne Doğum Tarihi",
                    [nameof(Model.MotherFullName)] = "Anne Ad Soyad",
                    [nameof(Model.PhoneNumber)] = "Telefon",
                    [nameof(Model.BabyNationalId)] = "Bebek T.C. Kimlik No"
                };

                var allErrors = ViewData.ModelState
                .Where(kv => kv.Value?.Errors?.Count > 0)
                .SelectMany(kv => kv.Value!.Errors.Select(e => new
                {
                    Key = kv.Key,
                    Label = string.IsNullOrEmpty(kv.Key) ? "Form" :
                (labels.ContainsKey(kv.Key) ? labels[kv.Key] : kv.Key),
                    Message = e.ErrorMessage
                }))
                .ToList();
            }
            @if (allErrors.Any())
            {
                <div class="alert alert-danger" role="alert">
                    <div><strong>Lütfen formu kontrol ediniz:</strong></div>
                    <ul class="mb-0">
                        @foreach (var err in allErrors)
                        {
                            <li>@err.Label: @err.Message</li>
                        }
                    </ul>
                </div>
            }

            <div class="row g-3 equal-row">
                <!-- SOL: BAŞVURU FORMU -->
                <div class="col-lg-7">
                    <div class="form-section p-2 p-md-3">
                        <form asp-action="Create" asp-controller="Applications" method="post" novalidate>
                            @Html.AntiForgeryToken()
                            <input type="hidden" asp-for="ProgramCode" />

                            <div class="mb-3 row">
                                <label class="col-md-4 col-form-label fw-semibold req" asp-for="MotherNationalId"></label>
                                <div class="col-md-8">
                                    <input class="form-control"
                                           asp-for="MotherNationalId"
                                           autocomplete="off" inputmode="numeric" maxlength="11"
                                           aria-describedby="MotherNationalIdFeedback" />
                                    <span id="MotherNationalIdFeedback"
                                          class="invalid-feedback d-block text-danger"
                                          asp-validation-for="MotherNationalId"></span>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-md-4 col-form-label fw-semibold req" asp-for="MotherBirthDate"></label>
                                <div class="col-md-8">
                                    <input class="form-control"
                                           asp-for="MotherBirthDate"
                                           type="date"
                                           aria-describedby="MotherBirthDateFeedback" />
                                    <span id="MotherBirthDateFeedback"
                                          class="invalid-feedback d-block text-danger"
                                          asp-validation-for="MotherBirthDate"></span>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-md-4 col-form-label fw-semibold req" asp-for="MotherFullName"></label>
                                <div class="col-md-8">
                                    <input class="form-control"
                                           asp-for="MotherFullName"
                                           maxlength="100"
                                           aria-describedby="MotherFullNameFeedback" />
                                    <span id="MotherFullNameFeedback"
                                          class="invalid-feedback d-block text-danger"
                                          asp-validation-for="MotherFullName"></span>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-md-4 col-form-label fw-semibold req" asp-for="PhoneNumber"></label>
                                <div class="col-md-8">
                                    <input class="form-control"
                                           asp-for="PhoneNumber"
                                           inputmode="tel" maxlength="11"
                                           aria-describedby="PhoneNumberFeedback" />
                                    <span id="PhoneNumberFeedback"
                                          class="invalid-feedback d-block text-danger"
                                          asp-validation-for="PhoneNumber"></span>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <label class="col-md-4 col-form-label fw-semibold req" asp-for="BabyNationalId"></label>
                                <div class="col-md-8">
                                    <input class="form-control"
                                           asp-for="BabyNationalId"
                                           autocomplete="off" inputmode="numeric" maxlength="11"
                                           aria-describedby="BabyNationalIdFeedback" />
                                    <span id="BabyNationalIdFeedback"
                                          class="invalid-feedback d-block text-danger"
                                          asp-validation-for="BabyNationalId"></span>
                                </div>
                            </div>

                            <div class="text-center">
                                <button type="submit" class="btn btn-success">📤 Başvuru Yap</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- SAĞ: BİLGİLENDİRME -->
                <div class="col-lg-5">
                    <div class="info-card">
                        <h5>Battalgazi Belediyesi Bebek Bezi Desteği</h5>

                        <div class="info-meta">
                            <div class="info-pill"><strong>Başlangıç:</strong> 01.06.2025</div>
                            <div class="info-pill"><strong>Bitiş:</strong> 31.12.2025</div>
                        </div>

                        <ul>
                            <li><strong>Müdürlük:</strong> SOSYAL YARDIM İŞLERİ ŞUBE MÜDÜRLÜĞÜ</li>
                            <li><strong>Projenin amacı:</strong> 2025 “Aile yılı” kapsamında bebek bezi desteği</li>
                        </ul>

                        <hr />

                        <ul>
                            <li>TÜRKİYE CUMHURİYETİ vatandaşı olmak</li>
                            <li>Battalgazi ilçe sınırlarında ikamet ediyor olması</li>
                            <li>Bez desteği alacak çocukların 0–24 ay arasında olması</li>
                            <li>Ailenin dar gelirli olması (iki asgari ücret altında)</li>
                            <li>Sosyal uyum yardımı <u>almayan</u> aileler başvurabilir</li>
                            <li>Eksik/sahte başvurular reddedilir</li>
                            <li>Başvurular bebeğin annesi üzerinden online yapılır</li>
                        </ul>

                        <p class="info-note">NOT: Başvurular yalnızca online sistem üzerinden kabul edilmektedir.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-footer text-center text-muted small">
            <strong>Battalgazi Belediyesi Bilgi İşlem Müdürlüğü</strong>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Basit sayısal maskeleme
        function onlyDigits(v){ return (v||"").replace(/\D+/g,""); }
        document.addEventListener("input", function(e){
            if(e.target.id==="MotherNationalId" || e.target.id==="BabyNationalId"){
                e.target.value = onlyDigits(e.target.value).slice(0,11);
            }
            if(e.target.id==="PhoneNumber"){
                e.target.value = onlyDigits(e.target.value).slice(0,11);
            }
        });
    </script>
}
